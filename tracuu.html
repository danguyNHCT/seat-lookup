<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tra c·ª©u gh·∫ø theo Username</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 1200px;
            width: 100%;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header .event-title {
            color: #7c2d12;
            margin-bottom: 15px;
            font-size: 1.4em;
            font-weight: 700;
            line-height: 1.3;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .header h1 {
            color: #92400e;
            margin-bottom: 10px;
            font-size: 1.5em;
            font-weight: 600;
        }

        .search-section {
            margin-bottom: 30px;
        }

        .input-tooltip {
            background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);
            color: #01579b;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #0277bd;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(2, 119, 189, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-tooltip::before {
            content: "üí°";
            font-size: 16px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            position: relative;
        }

        .input-container {
            flex: 1;
            position: relative;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px 50px 12px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #dc2626;
        }

        .input-actions {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .clear-btn {
            background: rgba(255, 107, 107, 0.1);
            color: #ff6b6b;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .clear-btn:hover {
            background: rgba(255, 107, 107, 0.2);
            transform: scale(1.1);
        }

        .search-btn {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            white-space: nowrap;
        }

        .search-btn:hover {
            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }

        .search-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .result-section {
            margin-bottom: 30px;
        }

        .seat-info {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #dc2626;
            margin-bottom: 20px;
        }

        .seat-info h3 {
            color: #7c2d12;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .seat-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .detail-item {
            background: white;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #fed7aa;
        }

        .detail-label {
            font-weight: bold;
            color: #a16207;
            font-size: 0.9em;
        }

        .detail-value {
            color: #7c2d12;
            font-size: 1.1em;
            margin-top: 5px;
            font-weight: 600;
        }

        .seating-chart {
            background: linear-gradient(135deg, #fefce8 0%, #fef3c7 100%);
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            border: 1px solid #fed7aa;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .chart-title {
            text-align: center;
            margin-bottom: 20px;
            color: #7c2d12;
            font-size: 1.2em;
            font-weight: bold;
            flex-shrink: 0;
            width: 100%;
        }

        .stage {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            text-align: center;
            padding: 10px;
            margin: 0 0 20px 0;
            border-radius: 8px;
            width: calc(24 * 38px + 23 * 3px + 30px);
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(220, 38, 38, 0.3);
            flex-shrink: 0;
        }

        .rows {
            display: flex;
            flex-direction: column;
            gap: 6px;
            align-items: flex-start;
            width: calc(24 * 38px + 23 * 3px + 30px);
            flex-shrink: 0;
        }

        .row {
            display: flex;
            align-items: center;
            gap: 3px;
            flex-wrap: nowrap;
        }

        .seat {
            width: 38px;
            height: 30px;
            border: 2px solid #fed7aa;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            transition: all 0.3s;
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            color: #a16207;
            flex-shrink: 0;
            user-select: none;
        }

        .seat.selected {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            border-color: #991b1b;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
        }

        .seat.vip-area {
            background: linear-gradient(135deg, #fde047 0%, #facc15 100%);
            color: #713f12;
            border-color: #eab308;
            font-weight: 900;
            animation: vipGlow 2s ease-in-out infinite alternate;
            box-shadow: 0 2px 8px rgba(234, 179, 8, 0.4);
        }

        .error-message {
            background: #fecaca;
            color: #991b1b;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #dc2626;
            animation: slideIn 0.5s ease;
        }

        .username-suggestion {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 15px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            border: 1px solid #fed7aa;
            transition: all 0.3s ease;
        }

        .username-suggestion:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.1);
        }

        .username-text {
            flex: 1;
            text-align: left;
            font-size: 14px;
            color: #333;
            margin-right: 10px;
        }

        .copy-btn {
            background: rgba(220, 38, 38, 0.1);
            color: #dc2626;
            border: 1px solid rgba(220, 38, 38, 0.3);
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .copy-btn:hover {
            background: rgba(220, 38, 38, 0.2);
            transform: scale(1.05);
        }

        .suggestions-container {
            margin-top: 15px;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #dc2626;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        .hidden {
            display: none;
        }

        @keyframes vipGlow {
            0% { box-shadow: 0 2px 8px rgba(234, 179, 8, 0.4); }
            100% { box-shadow: 0 4px 16px rgba(234, 179, 8, 0.6); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 1250px) {
            .container { max-width: 95%; padding: 15px; }
        }

        @media (max-width: 768px) {
            .container { padding: 20px; }
            .header .event-title { font-size: 1.2em; }
            .header h1 { font-size: 1.3em; }
            .input-tooltip { padding: 10px 12px; font-size: 13px; }
            .input-group { flex-direction: column; }
            .seat { width: 32px; height: 25px; font-size: 9px; }
            .stage { width: calc(24 * 32px + 23 * 3px + 30px); }
            .rows { width: calc(24 * 32px + 23 * 3px + 30px); }
            .seating-chart { padding: 15px; align-items: flex-start; }
            .username-suggestion { padding: 8px 12px; }
            .username-text { font-size: 13px; }
            .copy-btn { padding: 4px 8px; font-size: 11px; }
        }

        @media (max-width: 480px) {
            .header .event-title { font-size: 1em; }
            .header h1 { font-size: 1.1em; }
            .input-tooltip { padding: 8px 10px; font-size: 12px; }
            .seat { width: 28px; height: 22px; font-size: 8px; }
            .stage { width: calc(24 * 28px + 23 * 2px + 20px); font-size: 14px; }
            .rows { width: calc(24 * 28px + 23 * 2px + 20px); gap: 4px; }
            .row { gap: 2px; }
            .seating-chart { padding: 10px; }
            .seat:nth-child(6) { margin-right: 10px !important; }
            .seat:nth-child(18) { margin-right: 10px !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="event-title">
                ƒê·∫†I H·ªòI ƒê·∫†I BI·ªÇU ƒê·∫¢NG B·ªò NHCTVN L·∫¶N TH·ª® XI,<br>
                NHI·ªÜM K·ª≤ 2025 - 2030
            </div>
            <h1>Ch∆∞∆°ng tr√¨nh tra c·ª©u ch·ªó ng·ªìi ƒë·∫°i bi·ªÉu tham d·ª± ƒê·∫°i h·ªôi</h1>
        </div>

        <div class="search-section">
            <div class="input-tooltip">
                ƒê·∫°i bi·ªÉu vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ho·∫∑c username email ƒë·ªÉ tra c·ª©u ch·ªó ng·ªìi
            </div>
            <div class="input-group">
                <div class="input-container">
                    <input type="text" id="searchInput" placeholder="ƒê·∫°i bi·ªÉu nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ho·∫∑c username email t·∫°i ƒë√¢y..." />
                    <div class="input-actions">
                        <button class="clear-btn" id="clearBtn" onclick="clearInput()">‚úï</button>
                    </div>
                </div>
                <button class="search-btn" onclick="searchSeat()" id="searchBtn">Tra c·ª©u</button>
            </div>
        </div>

        <div id="errorMessage" class="error-message hidden"></div>

        <div id="resultSection" class="result-section hidden">
            <div class="seat-info">
                <h3>Th√¥ng tin gh·∫ø c·ªßa ƒë·∫°i bi·ªÉu:</h3>
                <div class="seat-details">
                    <div class="detail-item">
                        <div class="detail-label">H·ªç v√† t√™n</div>
                        <div class="detail-value" id="fullName"></div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">S·ªë gh·∫ø</div>
                        <div class="detail-value" id="seatNumber"></div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">H√†ng</div>
                        <div class="detail-value" id="rowNumber"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="seating-chart">
            <div class="chart-title">S∆° ƒë·ªì ch·ªó ng·ªìi</div>
            <div class="stage">S√ÇN KH·∫§U</div>
            <div class="rows" id="seatingRows"></div>
        </div>
    </div>

    <script>
        // ==================== OPTIMIZED DATA STRUCTURES ====================
        
        // T√°ch d·ªØ li·ªáu th√†nh c√°c c·∫•u tr√∫c t·ªëi ∆∞u
        const delegates = new Map();
        const phoneIndex = new Map();
        const usernameIndex = new Map();
        const usernameList = []; // Ch·ªâ l∆∞u usernames ƒë·ªÉ t·ªëi ∆∞u t√¨m ki·∫øm t∆∞∆°ng t·ª±
        
        // ========== THAY TH·∫æ TO√ÄN B·ªò H√ÄM N√ÄY B·∫∞NG D·ªÆ LI·ªÜU TH·∫¨T ==========
        function initializeDelegateData() {
            // üî• THAY TH·∫æ M·∫¢NG N√ÄY B·∫∞NG D·ªÆ LI·ªÜU 300 ƒê·∫†I BI·ªÇU TH·∫¨T
            const realDelegates = [
                // V√≠ d·ª• format d·ªØ li·ªáu th·∫≠t:
                { id: 1, username: "binhtm", phone: "0987654321", fullName: "Tr·∫ßn Minh B√¨nh", seatNumber: "A18", row: "A", position: 18 },
                { id: 2, username: "nh.quang", phone: "0912345678", fullName: "Nguy·ªÖn Ho√†ng Quang", seatNumber: "C6", row: "C", position: 6 },
                { id: 3, username: "xuanbtt", phone: "0923456789", fullName: "B√πi Th·ªã Thu Xu√¢n", seatNumber: "B19", row: "B", position: 19 },
                // ... TH√äM 297 B·∫¢N GHI TH·∫¨T N·ªÆA V√ÄO ƒê√ÇY
                
                // üí° HO·∫∂C LOAD T·ª™ API/FILE JSON:
                // const response = await fetch('/api/delegates');
                // const realDelegates = await response.json();
            ];

            // ‚ö†Ô∏è X√ìA TO√ÄN B·ªò PH·∫¶N T·∫†O D·ªÆ LI·ªÜU GI·∫¢ B√äN D∆Ø·ªöI KHI D√ôNG D·ªÆ LI·ªÜU TH·∫¨T
            
            // === PH·∫¶N T·∫†O D·ªÆ LI·ªÜU GI·∫¢ (X√ìA KHI D√ôNG D·ªÆ LI·ªÜU TH·∫¨T) ===
            const names = ["Nguy·ªÖn", "Tr·∫ßn", "L√™", "Ph·∫°m", "Ho√†ng", "Phan", "V≈©", "V√µ", "ƒê·∫∑ng", "B√πi"];
            const firstNames = ["VƒÉn", "Th·ªã", "Minh", "H∆∞∆°ng", "Quang", "H·∫£i", "Thu", "Ph√∫c", "ƒê·ª©c", "Ho√†ng"];
            const lastNames = ["An", "B√¨nh", "C∆∞·ªùng", "Dung", "Em", "Giang", "H·∫°nh", "Kh√°nh", "Linh", "Minh"];
            
            const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N'];
            const seatsPerRow = 24;
            let seatCounter = 6; // B·∫Øt ƒë·∫ßu t·ª´ gh·∫ø th·ª© 7
            
            for (let i = 4; i <= 300; i++) {
                const name = names[i % names.length];
                const firstName = firstNames[i % firstNames.length];
                const lastName = lastNames[i % lastNames.length];
                
                const rowIndex = Math.floor(seatCounter / seatsPerRow);
                const seatInRow = (seatCounter % seatsPerRow) + 1;
                const row = rows[rowIndex] || 'N';
                
                realDelegates.push({
                    id: i,
                    username: `user${i.toString().padStart(3, '0')}`,
                    phone: `09${(10000000 + i).toString().slice(1)}`,
                    fullName: `${name} ${firstName} ${lastName}`,
                    seatNumber: `${row}${seatInRow}`,
                    row: row,
                    position: seatInRow
                });
                
                seatCounter++;
            }
            // === H·∫æT PH·∫¶N T·∫†O D·ªÆ LI·ªÜU GI·∫¢ ===

            // üîß PH·∫¶N X·ª¨ L√ù INDEX (GI·ªÆ NGUY√äN)
            realDelegates.forEach(delegate => {
                delegates.set(delegate.id, delegate);
                phoneIndex.set(delegate.phone, delegate.id);
                usernameIndex.set(delegate.username.toLowerCase(), delegate.id);
                usernameList.push(delegate.username);
            });
        }

        // ==================== OPTIMIZED SEARCH FUNCTIONS ====================
        
        // T√¨m ki·∫øm t·ªëi ∆∞u b·∫±ng Map O(1)
        function findDelegate(searchKey) {
            const lowerKey = searchKey.toLowerCase();
            
            // T√¨m theo phone
            if (/^\d/.test(searchKey)) {
                const delegateId = phoneIndex.get(searchKey);
                return delegateId ? delegates.get(delegateId) : null;
            }
            
            // T√¨m theo username
            const delegateId = usernameIndex.get(lowerKey);
            return delegateId ? delegates.get(delegateId) : null;
        }

        // T·ªëi ∆∞u t√¨m ki·∫øm t∆∞∆°ng t·ª± v·ªõi binary search v√† prefix matching
        function findSimilarUsernames(searchInput) {
            const searchLower = searchInput.toLowerCase();
            const searchLen = searchLower.length;
            
            if (searchLen < 2) return [];
            
            // T√¨m prefix match tr∆∞·ªõc (nhanh h∆°n)
            const prefixMatches = usernameList.filter(username => 
                username.toLowerCase().startsWith(searchLower.slice(0, 2))
            );
            
            if (prefixMatches.length === 0) return [];
            
            // T√≠nh similarity ch·ªâ cho prefix matches
            const results = prefixMatches
                .map(username => ({
                    username,
                    similarity: calculateSimilarity(searchLower, username.toLowerCase())
                }))
                .filter(item => item.similarity > 0.4) // L·ªçc similarity th·∫•p
                .sort((a, b) => b.similarity - a.similarity)
                .slice(0, 3)
                .map(item => item.username);
            
            return results;
        }

        // T·ªëi ∆∞u h√†m t√≠nh similarity v·ªõi early termination
        function calculateSimilarity(str1, str2) {
            const len1 = str1.length;
            const len2 = str2.length;
            const maxLen = Math.max(len1, len2);
            
            // Early termination cho ƒë·ªô d√†i qu√° kh√°c bi·ªát
            if (Math.abs(len1 - len2) > maxLen * 0.5) return 0;
            
            // Simplified Levenshtein v·ªõi early termination
            const matrix = Array(len1 + 1).fill().map(() => Array(len2 + 1).fill(0));
            
            for (let i = 0; i <= len1; i++) matrix[i][0] = i;
            for (let j = 0; j <= len2; j++) matrix[0][j] = j;
            
            for (let i = 1; i <= len1; i++) {
                for (let j = 1; j <= len2; j++) {
                    const cost = str1[i - 1] === str2[j - 1] ? 0 : 1;
                    matrix[i][j] = Math.min(
                        matrix[i - 1][j] + 1,
                        matrix[i][j - 1] + 1,
                        matrix[i - 1][j - 1] + cost
                    );
                }
            }
            
            return (maxLen - matrix[len1][len2]) / maxLen;
        }

        // ==================== OPTIMIZED DOM OPERATIONS ====================
        
        let seatingChartCreated = false;
        
        // Lazy loading cho seating chart
        function createSeatingChart() {
            if (seatingChartCreated) return;
            
            const seatingRows = document.getElementById('seatingRows');
            const fragment = document.createDocumentFragment();
            
            const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N'];
            const seatsPerRow = 24;
            
            rows.forEach(rowLabel => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'row';
                
                for (let i = 1; i <= seatsPerRow; i++) {
                    const seatDiv = document.createElement('div');
                    seatDiv.className = 'seat';
                    seatDiv.id = `seat-${rowLabel}${i}`;
                    seatDiv.textContent = `${rowLabel}${i}`;
                    
                    if (i === 6) seatDiv.style.marginRight = '15px';
                    if (i === 18) seatDiv.style.marginRight = '15px';
                    
                    rowDiv.appendChild(seatDiv);
                }
                
                if (rowLabel === 'H') rowDiv.style.marginBottom = '15px';
                fragment.appendChild(rowDiv);
            });
            
            seatingRows.appendChild(fragment);
            seatingChartCreated = true;
        }

        // Cache DOM elements
        const domCache = {};
        function getCachedElement(id) {
            if (!domCache[id]) {
                domCache[id] = document.getElementById(id);
            }
            return domCache[id];
        }

        // ==================== OPTIMIZED EVENT HANDLERS ====================
        
        let searchTimeout;
        let isLoading = false;
        
        function searchSeat() {
            if (isLoading) return;
            
            const input = getCachedElement('searchInput').value.trim();
            const errorMessage = getCachedElement('errorMessage');
            const resultSection = getCachedElement('resultSection');
            const searchBtn = getCachedElement('searchBtn');

            // Reset UI
            errorMessage.classList.add('hidden');
            resultSection.classList.add('hidden');
            resetHighlight();

            if (!input) {
                showError('Vui l√≤ng nh·∫≠p username email ho·∫∑c s·ªë ƒëi·ªán tho·∫°i!');
                return;
            }

            const isPhone = /^\d/.test(input);
            if (!isPhone && !isValidUsername(input)) {
                showError('Username email ho·∫∑c s·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá!');
                return;
            }

            isLoading = true;
            searchBtn.innerHTML = '<span class="loading"></span>ƒêang tra c·ª©u...';
            searchBtn.disabled = true;

            // T√¨m ki·∫øm ngay l·∫≠p t·ª©c (ƒë√£ t·ªëi ∆∞u O(1))
            setTimeout(() => {
                const delegate = findDelegate(input);
                
                if (!delegate) {
                    handleSearchNotFound(input, isPhone);
                } else {
                    displaySeatInfo(delegate);
                    highlightSeatOrVIP(delegate);
                }

                isLoading = false;
                searchBtn.innerHTML = 'Tra c·ª©u';
                searchBtn.disabled = false;
            }, 100); // Gi·∫£m delay t·ª´ 500ms xu·ªëng 100ms
        }

        function handleSearchNotFound(input, isPhone) {
            if (!isPhone) {
                const similarUsernames = findSimilarUsernames(input);
                let errorMsg = `‚ùå <strong>Kh√¥ng t√¨m th·∫•y username n√†y trong h·ªá th·ªëng!</strong>`;
                
                if (similarUsernames.length > 0) {
                    errorMsg += `<br><br><strong>üîç Username g·ª£i √Ω:</strong>`;
                    errorMsg += `<div class="suggestions-container">`;
                    similarUsernames.forEach(username => {
                        errorMsg += `
                            <div class="username-suggestion">
                                <div class="username-text">üí° ${username}</div>
                                <button class="copy-btn" onclick="copyInput('${username}')">üîç Tra c·ª©u</button>
                            </div>
                        `;
                    });
                    errorMsg += `</div>`;
                }
                showError(errorMsg);
            } else {
                showError(`‚ùå <strong>Kh√¥ng t√¨m th·∫•y s·ªë ƒëi·ªán tho·∫°i n√†y trong h·ªá th·ªëng!</strong>`);
            }
        }

        function displaySeatInfo(delegate) {
            getCachedElement('fullName').textContent = delegate.fullName;
            getCachedElement('seatNumber').textContent = (delegate.row === 'A' || delegate.row === 'B') ? 'VIP' : delegate.seatNumber;
            getCachedElement('rowNumber').textContent = delegate.row;
            getCachedElement('resultSection').classList.remove('hidden');
        }

        function highlightSeatOrVIP(delegate) {
            if (!seatingChartCreated) createSeatingChart();
            
            if (delegate.row === 'A' || delegate.row === 'B') {
                highlightVIPRow(delegate.row);
            } else {
                highlightSeat(delegate.seatNumber);
            }
        }

        // ==================== OTHER OPTIMIZED FUNCTIONS ====================
        
        function resetHighlight() {
            // S·ª≠ d·ª•ng querySelectorAll v·ªõi cache v√† batch operations
            const selectedSeats = document.querySelectorAll('.seat.selected, .seat.vip-area');
            selectedSeats.forEach(seat => {
                seat.classList.remove('selected', 'vip-area');
            });
        }

        function highlightVIPRow(row) {
            const seatsPerRow = 24;
            const fragment = document.createDocumentFragment();
            
            for (let i = 1; i <= seatsPerRow; i++) {
                const seatElement = document.getElementById(`seat-${row}${i}`);
                if (seatElement) {
                    seatElement.classList.add('vip-area');
                }
            }

            // Smooth scroll v·ªõi intersection observer n·∫øu c·∫ßn
            const firstSeat = document.getElementById(`seat-${row}1`);
            if (firstSeat) {
                firstSeat.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function highlightSeat(seatNumber) {
            const seatElement = document.getElementById(`seat-${seatNumber}`);
            if (seatElement) {
                seatElement.classList.add('selected');
                seatElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function showError(message) {
            const errorMessage = getCachedElement('errorMessage');
            errorMessage.innerHTML = message;
            errorMessage.classList.remove('hidden');
        }

        function isValidUsername(input) {
            if (/^\d/.test(input)) {
                return /^0\d{9,10}$/.test(input);
            }
            return /^[a-zA-Z0-9.]+$/.test(input) && input.length >= 2;
        }

        function toggleClearButton() {
            const searchInput = getCachedElement('searchInput');
            const clearBtn = getCachedElement('clearBtn');
            
            clearBtn.style.display = searchInput.value.trim() ? 'flex' : 'none';
        }

        function clearInput() {
            const searchInput = getCachedElement('searchInput');
            searchInput.value = '';
            searchInput.focus();
            toggleClearButton();
            
            getCachedElement('errorMessage').classList.add('hidden');
            getCachedElement('resultSection').classList.add('hidden');
            resetHighlight();
        }

        function copyInput(input) {
            const searchInput = getCachedElement('searchInput');
            
            searchInput.value = input;
            searchInput.focus();
            toggleClearButton();
            
            // T·ª± ƒë·ªông search ngay l·∫≠p t·ª©c
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                if (getCachedElement('searchInput').value.trim().toLowerCase() === input.toLowerCase()) {
                    searchSeat();
                }
            }, 300); // Gi·∫£m t·ª´ 1000ms xu·ªëng 300ms
        }

        // ==================== OPTIMIZED EVENT LISTENERS ====================
        
        // Throttle input events ƒë·ªÉ t·ªëi ∆∞u performance
        function throttle(func, delay) {
            let timeoutId;
            let lastExecTime = 0;
            return function (...args) {
                const currentTime = Date.now();
                
                if (currentTime - lastExecTime > delay) {
                    func.apply(this, args);
                    lastExecTime = currentTime;
                } else {
                    clearTimeout(timeoutId);
                    timeoutId = setTimeout(() => {
                        func.apply(this, args);
                        lastExecTime = Date.now();
                    }, delay - (currentTime - lastExecTime));
                }
            };
        }

        const throttledToggleClear = throttle(toggleClearButton, 100);

        // ==================== INITIALIZATION ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Kh·ªüi t·∫°o d·ªØ li·ªáu
            initializeDelegateData();
            
            // Cache c√°c element th∆∞·ªùng d√πng
            getCachedElement('searchInput');
            getCachedElement('clearBtn');
            getCachedElement('searchBtn');
            getCachedElement('errorMessage');
            getCachedElement('resultSection');
            
            // Event listeners v·ªõi optimizations
            const searchInput = getCachedElement('searchInput');
            
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    searchSeat();
                }
            });

            searchInput.addEventListener('input', throttledToggleClear);
            
            // Focus v√†o input
            searchInput.focus();
            
            // Lazy load seating chart khi c·∫ßn
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        createSeatingChart();
                        observer.disconnect();
                    }
                });
            });
            
            const seatingChart = document.querySelector('.seating-chart');
            observer.observe(seatingChart);
        });

        // ==================== PERFORMANCE MONITORING ====================
        
        // Optional: Monitor performance in development
        if (typeof performance !== 'undefined' && performance.mark) {
            function measureSearchPerformance() {
                performance.mark('search-start');
                return () => {
                    performance.mark('search-end');
                    performance.measure('search-duration', 'search-start', 'search-end');
                    const measure = performance.getEntriesByName('search-duration')[0];
                    console.log(`Search completed in ${measure.duration.toFixed(2)}ms`);
                };
            }
        }
    </script>
</body>
</html>
